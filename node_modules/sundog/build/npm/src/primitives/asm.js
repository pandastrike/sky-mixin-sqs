"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _pandaParchment = require("panda-parchment");

var _pandaRiver = require("panda-river");

var _pandaGenerics = require("panda-generics");

var _lift = require("../lift");

var asmPrimitive;

asmPrimitive = function (SDK) {
  return function (configuration) {
    var asm, exists, get, list, read;
    asm = (0, _lift.applyConfiguration)(configuration, SDK.SecretsManager);

    list = async function (items = [], marker) {
      var NextToken, SecretList, parameters;
      parameters = marker != null ? {
        NextToken: marker
      } : {};
      ({
        SecretList,
        NextToken
      } = await asm.llistSecrets(parameters));
      items = (0, _pandaParchment.cat)(items, SecretList);

      if (NextToken != null) {
        return await list(items, NextToken);
      } else {
        return items;
      }
    };

    get = function (name) {
      return asm.getSecretValue({
        SecretId: name
      });
    };

    read = async function (name) {
      var data;
      data = await asm.getSecretValue({
        SecretId: name
      });

      if (data["SecretString"] != null) {
        return (0, _pandaParchment.fromJSON)(data["SecretString"]);
      } else {
        return Buffer.from(data.SecretBinary, 'base64');
      }
    };

    exists = async function (name) {
      var e;

      try {
        await get(name);
        return true;
      } catch (error) {
        e = error;
        return false;
      }
    };

    return {
      list,
      get,
      read,
      exists
    };
  };
};

var _default = asmPrimitive;
exports.default = _default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9zdW5kb2cvc3JjL3ByaW1pdGl2ZXMvYXNtLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSEEsSUFBQSxZQUFBOztBQUtBLFlBQUEsR0FBZSxVQUFBLEdBQUEsRUFBQTtTQUNiLFVBQUEsYUFBQSxFQUFBO0FBQ0UsUUFBQSxHQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQTtBQUFBLElBQUEsR0FBQSxHQUFNLDhCQUFBLGFBQUEsRUFBa0MsR0FBRyxDQUFyQyxjQUFBLENBQU47O0FBRUEsSUFBQSxJQUFBLEdBQU8sZ0JBQUMsS0FBQSxHQUFELEVBQUEsRUFBQSxNQUFBLEVBQUE7QUFDTCxVQUFBLFNBQUEsRUFBQSxVQUFBLEVBQUEsVUFBQTtBQUFBLE1BQUEsVUFBQSxHQUFnQixNQUFBLElBQUgsSUFBRyxHQUFhO0FBQUMsUUFBQSxTQUFBLEVBQVc7QUFBWixPQUFiLEdBQXNDLEVBQXREO0FBRUEsT0FBQTtBQUFBLFFBQUEsVUFBQTtBQUFBLFFBQUE7QUFBQSxVQUEwQixNQUFNLEdBQUcsQ0FBSCxZQUFBLENBQWhDLFVBQWdDLENBQWhDO0FBQ0EsTUFBQSxLQUFBLEdBQVEseUJBQUEsS0FBQSxFQUFBLFVBQUEsQ0FBUjs7QUFDQSxVQUFHLFNBQUEsSUFBSCxJQUFBLEVBQUE7QUFDRSxlQUFBLE1BQU0sSUFBQSxDQUFBLEtBQUEsRUFEUixTQUNRLENBQU47QUFERixPQUFBLE1BQUE7ZUFBQSxLOztBQUxLLEtBQVA7O0FBVUEsSUFBQSxHQUFBLEdBQU0sVUFBQSxJQUFBLEVBQUE7YUFBVSxHQUFHLENBQUgsY0FBQSxDQUFtQjtBQUFBLFFBQUEsUUFBQSxFQUFVO0FBQVYsT0FBbkIsQztBQUFWLEtBQU47O0FBRUEsSUFBQSxJQUFBLEdBQU8sZ0JBQUEsSUFBQSxFQUFBO0FBQ0gsVUFBQSxJQUFBO0FBQUEsTUFBQSxJQUFBLEdBQU8sTUFBTSxHQUFHLENBQUgsY0FBQSxDQUFtQjtBQUFBLFFBQUEsUUFBQSxFQUFVO0FBQVYsT0FBbkIsQ0FBYjs7QUFDQSxVQUFHLElBQUEsQ0FBQSxjQUFBLENBQUEsSUFBSCxJQUFBLEVBQUE7ZUFDRSw4QkFBUyxJQUFLLENBRGhCLGNBQ2dCLENBQWQsQztBQURGLE9BQUEsTUFBQTtlQUdFLE1BQU0sQ0FBTixJQUFBLENBQVksSUFBSSxDQUFoQixZQUFBLEVBSEYsUUFHRSxDOztBQUxDLEtBQVA7O0FBT0EsSUFBQSxNQUFBLEdBQVMsZ0JBQUEsSUFBQSxFQUFBO0FBQ1AsVUFBQSxDQUFBOztBQUFBLFVBQUE7QUFDRSxjQUFNLEdBQUEsQ0FBQSxJQUFBLENBQU47ZUFERixJO0FBQUEsT0FBQSxDQUFBLE9BQUEsS0FBQSxFQUFBO0FBR00sUUFBQSxDQUFBLEdBQUEsS0FBQTtlQUhOLEs7O0FBRE8sS0FBVDs7V0FPQTtBQUFBLE1BQUEsSUFBQTtBQUFBLE1BQUEsR0FBQTtBQUFBLE1BQUEsSUFBQTtBQUFBLE1BQUE7QUFBQSxLO0FBN0JGLEc7QUFEYSxDQUFmOztlQWdDZSxZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjYXQsIGZyb21KU09OfSBmcm9tIFwicGFuZGEtcGFyY2htZW50XCJcbmltcG9ydCB7Y29sbGVjdCwgcHJvamVjdH0gZnJvbSBcInBhbmRhLXJpdmVyXCJcbmltcG9ydCB7TWV0aG9kfSBmcm9tIFwicGFuZGEtZ2VuZXJpY3NcIlxuaW1wb3J0IHthcHBseUNvbmZpZ3VyYXRpb259IGZyb20gXCIuLi9saWZ0XCJcblxuYXNtUHJpbWl0aXZlID0gKFNESykgLT5cbiAgKGNvbmZpZ3VyYXRpb24pIC0+XG4gICAgYXNtID0gYXBwbHlDb25maWd1cmF0aW9uIGNvbmZpZ3VyYXRpb24sIFNESy5TZWNyZXRzTWFuYWdlclxuXG4gICAgbGlzdCA9IChpdGVtcz1bXSwgbWFya2VyKSAtPlxuICAgICAgcGFyYW1ldGVycyA9IGlmIG1hcmtlcj8gdGhlbiB7TmV4dFRva2VuOiBtYXJrZXJ9IGVsc2Uge31cblxuICAgICAge1NlY3JldExpc3QsIE5leHRUb2tlbn0gPSBhd2FpdCBhc20ubGxpc3RTZWNyZXRzIHBhcmFtZXRlcnNcbiAgICAgIGl0ZW1zID0gY2F0IGl0ZW1zLCBTZWNyZXRMaXN0XG4gICAgICBpZiBOZXh0VG9rZW4/XG4gICAgICAgIGF3YWl0IGxpc3QgaXRlbXMsIE5leHRUb2tlblxuICAgICAgZWxzZVxuICAgICAgICBpdGVtc1xuXG4gICAgZ2V0ID0gKG5hbWUpIC0+IGFzbS5nZXRTZWNyZXRWYWx1ZSBTZWNyZXRJZDogbmFtZVxuXG4gICAgcmVhZCA9IChuYW1lKSAtPlxuICAgICAgICBkYXRhID0gYXdhaXQgYXNtLmdldFNlY3JldFZhbHVlIFNlY3JldElkOiBuYW1lXG4gICAgICAgIGlmIGRhdGFbXCJTZWNyZXRTdHJpbmdcIl0/XG4gICAgICAgICAgZnJvbUpTT04gZGF0YVtcIlNlY3JldFN0cmluZ1wiXVxuICAgICAgICBlbHNlXG4gICAgICAgICAgQnVmZmVyLmZyb20gZGF0YS5TZWNyZXRCaW5hcnksICdiYXNlNjQnXG5cbiAgICBleGlzdHMgPSAobmFtZSkgLT5cbiAgICAgIHRyeVxuICAgICAgICBhd2FpdCBnZXQgbmFtZVxuICAgICAgICB0cnVlXG4gICAgICBjYXRjaCBlXG4gICAgICAgIGZhbHNlXG5cbiAgICB7bGlzdCwgZ2V0LCByZWFkLCBleGlzdHN9XG5cbmV4cG9ydCBkZWZhdWx0IGFzbVByaW1pdGl2ZVxuIl0sInNvdXJjZVJvb3QiOiIifQ==
//# sourceURL=/Users/david/repos/sundog/src/primitives/asm.coffee