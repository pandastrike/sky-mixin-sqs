"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _pandaParchment = require("panda-parchment");

var _pandaRiver = require("panda-river");

var _privateUtils = require("./private-utils");

var _url = require("../helpers/url");

var _lift = require("../lift");

var route53Primitive;

route53Primitive = function (SDK) {
  return function (configuration) {
    var hzGet, hzList, recordGet, recordList, route53;
    route53 = (0, _lift.applyConfiguration)(configuration, SDK.Route53);

    hzList = async function (current = [], marker) {
      var data, params;
      params = {
        MaxItems: "100"
      };

      if (marker) {
        params.Marker = marker;
      }

      data = await route53.listHostedZones(params);
      current = (0, _pandaParchment.cat)(current, data.HostedZones);

      if (data.IsTruncated) {
        return await _listHZ(current, data.Marker);
      } else {
        return current;
      }
    };

    recordList = async function (id, current = [], marker) {
      var data, params;
      params = {
        HostedZoneId: id,
        MaxItems: "100"
      };

      if (marker) {
        params.StartRecordName = marker;
      }

      data = await route53.listResourceRecordSets(params);
      current = (0, _pandaParchment.cat)(current, data.ResourceRecordSets);

      if (data.IsTruncated) {
        return await _listRecords(id, current, data.NextRecordName);
      } else {
        return current;
      }
    };

    hzGet = async function (name) {
      var result, zone, zones;
      zone = (0, _url.root)(name);
      zones = await hzList();
      result = (0, _pandaRiver.collect)((0, _privateUtils.where)({
        Name: zone
      }, zones));

      if ((0, _pandaParchment.empty)(result)) {
        return false;
      } else {
        return result[0].Id;
      }
    };

    recordGet = async function (name) {
      var records, result;
      records = await _listRecords((await _getHostedZoneID(name)));
      result = (0, _pandaRiver.collect)((0, _privateUtils.where)({
        Name: (0, _url.fullyQualify)(name)
      }, records));

      if ((0, _pandaParchment.empty)(result)) {
        return false;
      } else {
        return result[0];
      }
    };

    return {
      hzList,
      recordList,
      hzGet,
      recordGet
    };
  };
};

var _default = route53Primitive;
exports.default = _default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9zdW5kb2cvc3JjL3ByaW1pdGl2ZXMvcm91dGU1My5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUpBLElBQUEsZ0JBQUE7O0FBTUEsZ0JBQUEsR0FBbUIsVUFBQSxHQUFBLEVBQUE7U0FDakIsVUFBQSxhQUFBLEVBQUE7QUFDRSxRQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxFQUFBLFVBQUEsRUFBQSxPQUFBO0FBQUEsSUFBQSxPQUFBLEdBQVUsOEJBQUEsYUFBQSxFQUFrQyxHQUFHLENBQXJDLE9BQUEsQ0FBVjs7QUFFQSxJQUFBLE1BQUEsR0FBUyxnQkFBQyxPQUFBLEdBQUQsRUFBQSxFQUFBLE1BQUEsRUFBQTtBQUNQLFVBQUEsSUFBQSxFQUFBLE1BQUE7QUFBQSxNQUFBLE1BQUEsR0FBUztBQUFBLFFBQUEsUUFBQSxFQUFVO0FBQVYsT0FBVDs7QUFDQSxVQUFBLE1BQUEsRUFBQTtBQUFBLFFBQUEsTUFBTSxDQUFOLE1BQUEsR0FBQSxNQUFBOzs7QUFDQSxNQUFBLElBQUEsR0FBTyxNQUFNLE9BQU8sQ0FBUCxlQUFBLENBQU4sTUFBTSxDQUFiO0FBQ0EsTUFBQSxPQUFBLEdBQVUseUJBQUEsT0FBQSxFQUFhLElBQUksQ0FBakIsV0FBQSxDQUFWOztBQUNBLFVBQUcsSUFBSSxDQUFQLFdBQUEsRUFBQTtBQUNFLGVBQUEsTUFBTSxPQUFBLENBQUEsT0FBQSxFQUFpQixJQUFJLENBRDdCLE1BQ1EsQ0FBTjtBQURGLE9BQUEsTUFBQTtlQUFBLE87O0FBTE8sS0FBVDs7QUFVQSxJQUFBLFVBQUEsR0FBYSxnQkFBQSxFQUFBLEVBQUssT0FBQSxHQUFMLEVBQUEsRUFBQSxNQUFBLEVBQUE7QUFDWCxVQUFBLElBQUEsRUFBQSxNQUFBO0FBQUEsTUFBQSxNQUFBLEdBQ0U7QUFBQSxRQUFBLFlBQUEsRUFBQSxFQUFBO0FBQ0EsUUFBQSxRQUFBLEVBQVU7QUFEVixPQURGOztBQUdBLFVBQUEsTUFBQSxFQUFBO0FBQUEsUUFBQSxNQUFNLENBQU4sZUFBQSxHQUFBLE1BQUE7OztBQUNBLE1BQUEsSUFBQSxHQUFPLE1BQU0sT0FBTyxDQUFQLHNCQUFBLENBQU4sTUFBTSxDQUFiO0FBQ0EsTUFBQSxPQUFBLEdBQVUseUJBQUEsT0FBQSxFQUFhLElBQUksQ0FBakIsa0JBQUEsQ0FBVjs7QUFDQSxVQUFHLElBQUksQ0FBUCxXQUFBLEVBQUE7QUFDRSxlQUFBLE1BQU0sWUFBQSxDQUFBLEVBQUEsRUFBQSxPQUFBLEVBQTBCLElBQUksQ0FEdEMsY0FDUSxDQUFOO0FBREYsT0FBQSxNQUFBO2VBQUEsTzs7QUFQVyxLQUFiOztBQVlBLElBQUEsS0FBQSxHQUFRLGdCQUFBLElBQUEsRUFBQTtBQUNOLFVBQUEsTUFBQSxFQUFBLElBQUEsRUFBQSxLQUFBO0FBQUEsTUFBQSxJQUFBLEdBQU8sZUFBQSxJQUFBLENBQVA7QUFDQSxNQUFBLEtBQUEsR0FBUSxNQUFNLE1BQU4sRUFBUjtBQUNBLE1BQUEsTUFBQSxHQUFTLHlCQUFRLHlCQUFNO0FBQUMsUUFBQSxJQUFBLEVBQU07QUFBUCxPQUFOLEVBQVIsS0FBUSxDQUFSLENBQVQ7O0FBQ0EsVUFBRywyQkFBSCxNQUFHLENBQUgsRUFBQTtlQUFBLEs7QUFBQSxPQUFBLE1BQUE7ZUFBZ0MsTUFBTyxDQUFBLENBQUEsQ0FBUCxDQUFoQyxFOztBQUpNLEtBQVI7O0FBTUEsSUFBQSxTQUFBLEdBQVksZ0JBQUEsSUFBQSxFQUFBO0FBQ1YsVUFBQSxPQUFBLEVBQUEsTUFBQTtBQUFBLE1BQUEsT0FBQSxHQUFVLE1BQU0sWUFBQSxFQUFhLE1BQU0sZ0JBQUEsQ0FBekIsSUFBeUIsQ0FBbkIsRUFBaEI7QUFDQSxNQUFBLE1BQUEsR0FBUyx5QkFBUSx5QkFBTTtBQUFDLFFBQUEsSUFBQSxFQUFNLHVCQUFBLElBQUE7QUFBUCxPQUFOLEVBQVIsT0FBUSxDQUFSLENBQVQ7O0FBQ0EsVUFBRywyQkFBSCxNQUFHLENBQUgsRUFBQTtlQUFBLEs7QUFBQSxPQUFBLE1BQUE7ZUFBZ0MsTUFBTyxDQUF2QyxDQUF1QyxDOztBQUg3QixLQUFaOztXQU9BO0FBQUEsTUFBQSxNQUFBO0FBQUEsTUFBQSxVQUFBO0FBQUEsTUFBQSxLQUFBO0FBQUEsTUFBQTtBQUFBLEs7QUF0Q0YsRztBQURpQixDQUFuQjs7ZUF5Q2UsZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2NhdCwgZW1wdHl9IGZyb20gXCJwYW5kYS1wYXJjaG1lbnRcIlxuaW1wb3J0IHtjb2xsZWN0fSBmcm9tIFwicGFuZGEtcml2ZXJcIlxuaW1wb3J0IHt3aGVyZX0gZnJvbSBcIi4vcHJpdmF0ZS11dGlsc1wiXG5pbXBvcnQge3Jvb3QsIGZ1bGx5UXVhbGlmeX0gZnJvbSBcIi4uL2hlbHBlcnMvdXJsXCJcbmltcG9ydCB7YXBwbHlDb25maWd1cmF0aW9ufSBmcm9tIFwiLi4vbGlmdFwiXG5cbnJvdXRlNTNQcmltaXRpdmUgPSAoU0RLKSAtPlxuICAoY29uZmlndXJhdGlvbikgLT5cbiAgICByb3V0ZTUzID0gYXBwbHlDb25maWd1cmF0aW9uIGNvbmZpZ3VyYXRpb24sIFNESy5Sb3V0ZTUzXG5cbiAgICBoekxpc3QgPSAoY3VycmVudD1bXSwgbWFya2VyKSAtPlxuICAgICAgcGFyYW1zID0gTWF4SXRlbXM6IFwiMTAwXCJcbiAgICAgIHBhcmFtcy5NYXJrZXIgPSBtYXJrZXIgaWYgbWFya2VyXG4gICAgICBkYXRhID0gYXdhaXQgcm91dGU1My5saXN0SG9zdGVkWm9uZXMgcGFyYW1zXG4gICAgICBjdXJyZW50ID0gY2F0IGN1cnJlbnQsIGRhdGEuSG9zdGVkWm9uZXNcbiAgICAgIGlmIGRhdGEuSXNUcnVuY2F0ZWRcbiAgICAgICAgYXdhaXQgX2xpc3RIWiBjdXJyZW50LCBkYXRhLk1hcmtlclxuICAgICAgZWxzZVxuICAgICAgICBjdXJyZW50XG5cbiAgICByZWNvcmRMaXN0ID0gKGlkLCBjdXJyZW50PVtdLCBtYXJrZXIpIC0+XG4gICAgICBwYXJhbXMgPVxuICAgICAgICBIb3N0ZWRab25lSWQ6IGlkXG4gICAgICAgIE1heEl0ZW1zOiBcIjEwMFwiXG4gICAgICBwYXJhbXMuU3RhcnRSZWNvcmROYW1lID0gbWFya2VyIGlmIG1hcmtlclxuICAgICAgZGF0YSA9IGF3YWl0IHJvdXRlNTMubGlzdFJlc291cmNlUmVjb3JkU2V0cyBwYXJhbXNcbiAgICAgIGN1cnJlbnQgPSBjYXQgY3VycmVudCwgZGF0YS5SZXNvdXJjZVJlY29yZFNldHNcbiAgICAgIGlmIGRhdGEuSXNUcnVuY2F0ZWRcbiAgICAgICAgYXdhaXQgX2xpc3RSZWNvcmRzIGlkLCBjdXJyZW50LCBkYXRhLk5leHRSZWNvcmROYW1lXG4gICAgICBlbHNlXG4gICAgICAgIGN1cnJlbnRcblxuICAgIGh6R2V0ID0gKG5hbWUpIC0+XG4gICAgICB6b25lID0gcm9vdCBuYW1lXG4gICAgICB6b25lcyA9IGF3YWl0IGh6TGlzdCgpXG4gICAgICByZXN1bHQgPSBjb2xsZWN0IHdoZXJlIHtOYW1lOiB6b25lfSwgem9uZXNcbiAgICAgIGlmIGVtcHR5IHJlc3VsdCB0aGVuIGZhbHNlIGVsc2UgcmVzdWx0WzBdLklkXG5cbiAgICByZWNvcmRHZXQgPSAobmFtZSkgLT5cbiAgICAgIHJlY29yZHMgPSBhd2FpdCBfbGlzdFJlY29yZHMgYXdhaXQgX2dldEhvc3RlZFpvbmVJRCBuYW1lXG4gICAgICByZXN1bHQgPSBjb2xsZWN0IHdoZXJlIHtOYW1lOiBmdWxseVF1YWxpZnkgbmFtZX0sIHJlY29yZHNcbiAgICAgIGlmIGVtcHR5IHJlc3VsdCB0aGVuIGZhbHNlIGVsc2UgcmVzdWx0WzBdXG5cblxuXG4gICAge2h6TGlzdCwgcmVjb3JkTGlzdCwgaHpHZXQsIHJlY29yZEdldH1cblxuZXhwb3J0IGRlZmF1bHQgcm91dGU1M1ByaW1pdGl2ZVxuIl0sInNvdXJjZVJvb3QiOiIifQ==
//# sourceURL=/Users/david/repos/sundog/src/primitives/route53.coffee