"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getKey = exports.wrap = exports.parse = exports.to = exports.default = void 0;

var _pandaGarden = require("panda-garden");

var _pandaParchment = require("panda-parchment");

//===========================================================================
// Type Helpers
//===========================================================================
// DynamoDB includes type information mapped into its data strctures.
// It expects data to be input that way, and includes it when fetched.
// These helpers write and parse that type system.
var _mark, _parse, _transform, getKey, isSet, parse, to, wrap;

exports.wrap = wrap;
exports.to = to;
exports.parse = parse;
exports.getKey = getKey;
isSet = (0, _pandaParchment.isType)(Set);

_transform = function (f) {
  return function (x) {
    var k, out, v;

    if ((0, _pandaParchment.isObject)(x)) {
      out = {};

      for (k in x) {
        v = x[k];
        out[k] = _mark("anonymousDynamodbValue", f(v));
      }

      return _mark("namedDynamodbValue", out);
    } else if (x == null) {
      throw new Error("sundog::dynamodb::to Cannot type cast value that is undefined.");
    } else {
      return _mark("anonymousDynamodbValue", f(x));
    }
  };
};

_mark = function (name, object) {
  return Object.defineProperty(object, "name", {
    value: name
  });
};

exports.to = to = {
  S: _transform(function (s) {
    return {
      S: s.toString()
    };
  }),
  N: _transform(function (n) {
    return {
      N: n.toString()
    };
  }),
  B: _transform(function (b) {
    return {
      B: b.toString("base64")
    };
  }),
  SS: _transform(function (a) {
    var i;

    if (isSet(a)) {
      a = Array.from(a);
    }

    return {
      SS: function () {
        var j, len, results;
        results = [];

        for (j = 0, len = a.length; j < len; j++) {
          i = a[j];
          results.push(i.toString());
        }

        return results;
      }()
    };
  }),
  NS: _transform(function (a) {
    var i;

    if (isSet(a)) {
      a = Array.from(a);
    }

    return {
      NS: function () {
        var j, len, results;
        results = [];

        for (j = 0, len = a.length; j < len; j++) {
          i = a[j];
          results.push(i.toString());
        }

        return results;
      }()
    };
  }),
  BS: _transform(function (a) {
    var i;

    if (isSet(a)) {
      a = Array.from(a);
    }

    return {
      BS: function () {
        var j, len, results;
        results = [];

        for (j = 0, len = a.length; j < len; j++) {
          i = a[j];
          results.push(i.toString("base64"));
        }

        return results;
      }()
    };
  }),
  M: _transform(function (m) {
    return {
      M: m
    };
  }),
  L: _transform(function (l) {
    return {
      L: l
    };
  }),
  NULL: _transform(function (n) {
    return {
      NULL: n
    };
  }),
  BOOL: _transform(function (b) {
    return {
      BOOL: b
    };
  }),
  // Extension of DynamoDB types to stringify objects. *Must always be named.*
  JSON: _transform(function (o) {
    return {
      S: JSON.stringify(o)
    };
  })
}; // This handles parsing on the data types native to DynamoDB, including recursive parsing on Maps.

_parse = function (attributes) {
  var dataType, i, name, result, typeObj, v;
  result = {};

  for (name in attributes) {
    typeObj = attributes[name];
    dataType = (0, _pandaParchment.first)((0, _pandaParchment.keys)(typeObj));
    v = (0, _pandaParchment.first)((0, _pandaParchment.values)(typeObj));

    result[name] = function () {
      var j, len, results;

      switch (dataType) {
        case "S":
        case "BOOL":
          return v;

        case "N":
          return Number(v);

        case "B":
          return Buffer.from(v, "base64");

        case "SS":
          return new Set(v);

        case "NS":
          return new Set(function () {
            var j, len, results;
            results = [];

            for (j = 0, len = v.length; j < len; j++) {
              i = v[j];
              results.push(Number(i));
            }

            return results;
          }());

        case "BS":
          return new Set(function () {
            var j, len, results;
            results = [];

            for (j = 0, len = v.length; j < len; j++) {
              i = v[j];
              results.push(Buffer.from(i, "base64"));
            }

            return results;
          }());

        case "NULL":
          if (v) {
            return null;
          } else {
            return void 0;
          }

          break;

        case "L":
          results = [];

          for (j = 0, len = v.length; j < len; j++) {
            i = v[j];
            results.push(parse(i));
          }

          return results;

        case "M":
          return parse(v);

        default:
          throw new Error(`Unable to parse object for DynamoDB attribute type. ${dataType}`);
      }
    }();
  }

  return result;
}; // This wraps _parse to extend parsing to data types we define.


exports.parse = parse = (0, _pandaGarden.curry)(function (types, data) {
  var name, result, type, value;
  result = _parse(data);

  for (name in result) {
    value = result[name];
    type = types[name];

    result[name] = function () {
      switch (type) {
        // NoOps on the base types
        case "S":
        case "N":
        case "BOOL":
        case "SS":
        case "L":
        case "B":
        case "NS":
        case "BS":
        case "NULL":
        case "M":
          return value;
        // Extensions

        case "JSON":
          return JSON.parse(value);

        default:
          throw new Error(`For ${name}, ${type} is not a known DynamoDB type or sundog extension.`);
      }
    }();
  }

  return result;
}); // Accept an incoming object to store in DynamoDB, rejecting fields that do not have a defined type or are not suitable for DynamoDB.
// From their docs:
// > Attribute values cannot be null. String and Binary type attributes must have lengths greater than zero. Set type attributes cannot be empty.

exports.wrap = wrap = (0, _pandaGarden.curry)(function (types, data) {
  var name, out, type, value;
  out = [];

  for (name in data) {
    value = data[name];

    if ((type = types[name]) != null && value != null) {
      switch (type) {
        case "S":
        case "SS":
        case "NS":
        case "BS":
        case "L":
        case "B":
          if (!(0, _pandaParchment.empty)(value)) {
            out.push(to[type]({
              [name]: value
            }));
          }

          break;

        case "N":
          if (!Number.isNaN(value)) {
            out.push(to[type]({
              [name]: value
            }));
          }

          break;

        case "BOOL":
        case "NULL":
          if ((0, _pandaParchment.isBoolean)(value)) {
            out.push(to[type]({
              [name]: value
            }));
          }

          break;

        case "M":
          if ((0, _pandaParchment.isObject)(value) && !(0, _pandaParchment.empty)((0, _pandaParchment.keys)(value))) {
            out.push(to[type]({
              [name]: value
            }));
          }

          break;

        case "JSON":
          if (!(0, _pandaParchment.empty)(JSON.stringify(value))) {
            out.push(to[type]({
              [name]: value
            }));
          }

          break;

        default:
          throw new Error(`Unable to wrap field '${name}'. Unknown DyanmoDB data type, '${type}'`);
      }
    }
  }

  return (0, _pandaParchment.merge)(...out);
}); // Given data and a model definition, return the key for this object.

exports.getKey = getKey = (0, _pandaGarden.curry)(function (definition, data) {
  var f, key, partition, sort;
  key = {};
  [partition, sort] = definition.key;

  if (sort != null) {
    // If there is a sort key, data must be an object and wrap both.
    f = to[definition.types[partition]];
    (0, _pandaParchment.include)(key, f({
      [partition]: data[partition]
    }));
    f = to[definition.types[sort]];
    (0, _pandaParchment.include)(key, f({
      [sort]: data[sort]
    }));
  } else {
    // With no sort key, it's possible we've been given just a value to be wrapped as the partition key.
    f = to[definition.types[partition]];

    if ((0, _pandaParchment.isObject)(data)) {
      (0, _pandaParchment.include)(key, f({
        [partition]: data[partition]
      }));
    } else {
      (0, _pandaParchment.include)(key, f({
        [partition]: data
      }));
    }
  }

  return key;
});
var _default = {
  to,
  parse,
  wrap,
  getKey
};
exports.default = _default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9zdW5kb2cvc3JjL3ByaW1pdGl2ZXMvZHluYW1vZGIvaGVscGVycy90eXBlcy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU1BOztBQUNBOztBQVBBOzs7Ozs7QUFBQSxJQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsVUFBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBOzs7Ozs7QUFVQSxLQUFBLEdBQVEsNEJBQUEsR0FBQSxDQUFSOztBQUVBLFVBQUEsR0FBYSxVQUFBLENBQUEsRUFBQTtTQUNYLFVBQUEsQ0FBQSxFQUFBO0FBQ0UsUUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLENBQUE7O0FBQUEsUUFBRyw4QkFBSCxDQUFHLENBQUgsRUFBQTtBQUNFLE1BQUEsR0FBQSxHQUFNLEVBQU47O0FBQzhDLFdBQUEsQ0FBQSxJQUFBLENBQUEsRUFBQTs7QUFBOUMsUUFBQSxHQUFJLENBQUosQ0FBSSxDQUFKLEdBQVMsS0FBQSxDQUFBLHdCQUFBLEVBQWdDLENBQUEsQ0FBaEMsQ0FBZ0MsQ0FBaEMsQ0FBVDtBQUE4Qzs7YUFDOUMsS0FBQSxDQUFBLG9CQUFBLEVBSEYsR0FHRSxDO0FBSEYsS0FBQSxNQUlLLElBQUksQ0FBQSxJQUFKLElBQUEsRUFBQTtBQUNILFlBQU0sSUFBQSxLQUFBLENBREgsZ0VBQ0csQ0FBTjtBQURHLEtBQUEsTUFBQTthQUdILEtBQUEsQ0FBQSx3QkFBQSxFQUFnQyxDQUFBLENBSDdCLENBRzZCLENBQWhDLEM7O0FBUkosRztBQURXLENBQWI7O0FBV0EsS0FBQSxHQUFRLFVBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQTtTQUFrQixNQUFNLENBQU4sY0FBQSxDQUFBLE1BQUEsRUFBQSxNQUFBLEVBQXNDO0FBQUEsSUFBQSxLQUFBLEVBQU87QUFBUCxHQUF0QyxDO0FBQWxCLENBQVI7O0FBRUEsYUFBQSxFQUFBLEdBQ0U7QUFBQSxFQUFBLENBQUEsRUFBRyxVQUFBLENBQVcsVUFBQSxDQUFBLEVBQUE7V0FBTztBQUFBLE1BQUEsQ0FBQSxFQUFHLENBQUMsQ0FBRCxRQUFBO0FBQUgsSztBQUFyQixHQUFHLENBQUg7QUFDQSxFQUFBLENBQUEsRUFBRyxVQUFBLENBQVcsVUFBQSxDQUFBLEVBQUE7V0FBTztBQUFBLE1BQUEsQ0FBQSxFQUFHLENBQUMsQ0FBRCxRQUFBO0FBQUgsSztBQURyQixHQUNHLENBREg7QUFFQSxFQUFBLENBQUEsRUFBRyxVQUFBLENBQVcsVUFBQSxDQUFBLEVBQUE7V0FBTztBQUFBLE1BQUEsQ0FBQSxFQUFHLENBQUMsQ0FBRCxRQUFBLENBQUEsUUFBQTtBQUFILEs7QUFGckIsR0FFRyxDQUZIO0FBR0EsRUFBQSxFQUFBLEVBQUksVUFBQSxDQUFXLFVBQUEsQ0FBQSxFQUFBO0FBQ2IsUUFBQSxDQUFBOztBQUFBLFFBQUcsS0FBQSxDQUFILENBQUcsQ0FBSCxFQUFBO0FBQWdCLE1BQUEsQ0FBQSxHQUFJLEtBQUssQ0FBTCxJQUFBLENBQXBCLENBQW9CLENBQUo7OztXQUNoQjtBQUFBLE1BQUEsRUFBQSxFQUFBLFlBQUE7O0FBQWtCLFFBQUEsT0FBQSxHQUFBLEVBQUE7O0FBQUEsYUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxDQUFBLENBQUEsTUFBQSxFQUFBLENBQUEsR0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUE7O3VCQUFiLENBQUMsQ0FBRCxRQUFBLEU7QUFBYTs7O09BQWxCO0FBQUEsSztBQUxGLEdBR0ksQ0FISjtBQU1BLEVBQUEsRUFBQSxFQUFJLFVBQUEsQ0FBVyxVQUFBLENBQUEsRUFBQTtBQUNiLFFBQUEsQ0FBQTs7QUFBQSxRQUFHLEtBQUEsQ0FBSCxDQUFHLENBQUgsRUFBQTtBQUFnQixNQUFBLENBQUEsR0FBSSxLQUFLLENBQUwsSUFBQSxDQUFwQixDQUFvQixDQUFKOzs7V0FDaEI7QUFBQSxNQUFBLEVBQUEsRUFBQSxZQUFBOztBQUFrQixRQUFBLE9BQUEsR0FBQSxFQUFBOztBQUFBLGFBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBOzt1QkFBYixDQUFDLENBQUQsUUFBQSxFO0FBQWE7OztPQUFsQjtBQUFBLEs7QUFSRixHQU1JLENBTko7QUFTQSxFQUFBLEVBQUEsRUFBSSxVQUFBLENBQVcsVUFBQSxDQUFBLEVBQUE7QUFDYixRQUFBLENBQUE7O0FBQUEsUUFBRyxLQUFBLENBQUgsQ0FBRyxDQUFILEVBQUE7QUFBZ0IsTUFBQSxDQUFBLEdBQUksS0FBSyxDQUFMLElBQUEsQ0FBcEIsQ0FBb0IsQ0FBSjs7O1dBQ2hCO0FBQUEsTUFBQSxFQUFBLEVBQUEsWUFBQTs7QUFBMEIsUUFBQSxPQUFBLEdBQUEsRUFBQTs7QUFBQSxhQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsR0FBQSxHQUFBLENBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEdBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQTs7dUJBQXJCLENBQUMsQ0FBRCxRQUFBLENBQUEsUUFBQSxDO0FBQXFCOzs7T0FBMUI7QUFBQSxLO0FBWEYsR0FTSSxDQVRKO0FBWUEsRUFBQSxDQUFBLEVBQUcsVUFBQSxDQUFXLFVBQUEsQ0FBQSxFQUFBO1dBQU87QUFBQSxNQUFBLENBQUEsRUFBRztBQUFILEs7QUFackIsR0FZRyxDQVpIO0FBYUEsRUFBQSxDQUFBLEVBQUcsVUFBQSxDQUFXLFVBQUEsQ0FBQSxFQUFBO1dBQU87QUFBQSxNQUFBLENBQUEsRUFBRztBQUFILEs7QUFickIsR0FhRyxDQWJIO0FBY0EsRUFBQSxJQUFBLEVBQU0sVUFBQSxDQUFXLFVBQUEsQ0FBQSxFQUFBO1dBQU87QUFBQSxNQUFBLElBQUEsRUFBTTtBQUFOLEs7QUFkeEIsR0FjTSxDQWROO0FBZUEsRUFBQSxJQUFBLEVBQU0sVUFBQSxDQUFXLFVBQUEsQ0FBQSxFQUFBO1dBQU87QUFBQSxNQUFBLElBQUEsRUFBTTtBQUFOLEs7QUFmeEIsR0FlTSxDQWZOOztBQWlCQSxFQUFBLElBQUEsRUFBTSxVQUFBLENBQVcsVUFBQSxDQUFBLEVBQUE7V0FBTztBQUFBLE1BQUEsQ0FBQSxFQUFHLElBQUksQ0FBSixTQUFBLENBQUEsQ0FBQTtBQUFILEs7QUFBbEIsR0FBQTtBQWpCTixDQURGLEM7O0FBcUJBLE1BQUEsR0FBUyxVQUFBLFVBQUEsRUFBQTtBQUNQLE1BQUEsUUFBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLE9BQUEsRUFBQSxDQUFBO0FBQUEsRUFBQSxNQUFBLEdBQVMsRUFBVDs7QUFDQSxPQUFBLElBQUEsSUFBQSxVQUFBLEVBQUE7O0FBQ0UsSUFBQSxRQUFBLEdBQVcsMkJBQU0sMEJBQU4sT0FBTSxDQUFOLENBQVg7QUFDQSxJQUFBLENBQUEsR0FBSSwyQkFBTSw0QkFBTixPQUFNLENBQU4sQ0FBSjs7QUFDQSxJQUFBLE1BQU8sQ0FBUCxJQUFPLENBQVAsR0FBQSxZQUFBOzs7QUFBZSxjQUFBLFFBQUE7QUFBQSxhQUFBLEdBQUE7QUFBQSxhQUFBLE1BQUE7aUJBQ1MsQzs7QUFEVCxhQUFBLEdBQUE7aUJBRUMsTUFBQSxDQUFBLENBQUEsQzs7QUFGRCxhQUFBLEdBQUE7aUJBR0MsTUFBTSxDQUFOLElBQUEsQ0FBQSxDQUFBLEVBQUEsUUFBQSxDOztBQUhELGFBQUEsSUFBQTtpQkFJRSxJQUFBLEdBQUEsQ0FBQSxDQUFBLEM7O0FBSkYsYUFBQSxJQUFBO2lCQUtFLElBQUEsR0FBQSxDQUFBLFlBQUE7O0FBQWtCLFlBQUEsT0FBQSxHQUFBLEVBQUE7O0FBQUEsaUJBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBOzsyQkFBVCxNQUFBLENBQUEsQ0FBQSxDO0FBQVM7OztBQUFsQixXQUFBLEVBQUEsQzs7QUFMRixhQUFBLElBQUE7aUJBTUUsSUFBQSxHQUFBLENBQUEsWUFBQTs7QUFBaUMsWUFBQSxPQUFBLEdBQUEsRUFBQTs7QUFBQSxpQkFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxDQUFBLENBQUEsTUFBQSxFQUFBLENBQUEsR0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUE7OzJCQUF4QixNQUFNLENBQU4sSUFBQSxDQUFBLENBQUEsRUFBQSxRQUFBLEM7QUFBd0I7OztBQUFqQyxXQUFBLEVBQUEsQzs7QUFORixhQUFBLE1BQUE7QUFRWCxjQUFBLENBQUEsRUFBQTttQkFBQSxJO0FBQUEsV0FBQSxNQUFBO21CQUFvQixLQUFwQixDOzs7QUFERzs7QUFQUSxhQUFBLEdBQUE7QUFTVSxVQUFBLE9BQUEsR0FBQSxFQUFBOztBQUFBLGVBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBOzt5QkFBUixLQUFBLENBQUEsQ0FBQSxDO0FBQVE7Ozs7QUFUVixhQUFBLEdBQUE7aUJBVUMsS0FBQSxDQUFBLENBQUEsQzs7QUFWRDtBQVlYLGdCQUFNLElBQUEsS0FBQSxDQUFVLHVEQUFBLFFBQVYsRUFBQSxDQUFOO0FBWlc7S0FBZixFQUFBO0FBSEY7O1NBZ0JBLE07QUFoRUYsQ0E4Q0EsQzs7O0FBcUJBLGdCQUFBLEtBQUEsR0FBUSx3QkFBTSxVQUFBLEtBQUEsRUFBQSxJQUFBLEVBQUE7QUFDWixNQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUE7QUFBQSxFQUFBLE1BQUEsR0FBUyxNQUFBLENBQUEsSUFBQSxDQUFUOztBQUNBLE9BQUEsSUFBQSxJQUFBLE1BQUEsRUFBQTs7QUFDRSxJQUFBLElBQUEsR0FBTyxLQUFNLENBQUEsSUFBQSxDQUFiOztBQUNBLElBQUEsTUFBTyxDQUFQLElBQU8sQ0FBUCxHQUFBLFlBQUE7QUFBZSxjQUFBLElBQUE7O0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxNQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxNQUFBO0FBQUEsYUFBQSxHQUFBO2lCQUFBLEs7OztBQUFBLGFBQUEsTUFBQTtpQkFNWCxJQUFJLENBQUosS0FBQSxDQUFBLEtBQUEsQzs7QUFOVztBQVFYLGdCQUFNLElBQUEsS0FBQSxDQUFVLE9BQUEsSUFBQSxLQUFBLElBQVYsb0RBQUEsQ0FBTjtBQVJXO0tBQWYsRUFBQTtBQUZGOztTQVdBLE07QUFoRkYsQ0FtRVEsQ0FBUixDOzs7O0FBa0JBLGVBQUEsSUFBQSxHQUFPLHdCQUFNLFVBQUEsS0FBQSxFQUFBLElBQUEsRUFBQTtBQUNYLE1BQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsS0FBQTtBQUFBLEVBQUEsR0FBQSxHQUFNLEVBQU47O0FBQ0EsT0FBQSxJQUFBLElBQUEsSUFBQSxFQUFBOzs7QUFDRSxRQUFHLENBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxJQUFBLElBQXlCLEtBQUEsSUFBNUIsSUFBQSxFQUFBO0FBQ0UsY0FBQSxJQUFBO0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxJQUFBO0FBQUEsYUFBQSxHQUFBO0FBQUEsYUFBQSxHQUFBO0FBRUksY0FBQSxDQUFPLDJCQUFQLEtBQU8sQ0FBUCxFQUFBO0FBQ0UsWUFBQSxHQUFHLENBQUgsSUFBQSxDQUFVLEVBQUcsQ0FBSCxJQUFHLENBQUgsQ0FBUztBQUFBLGVBQUEsSUFBQSxHQUFPO0FBQVAsYUFBVCxDQUFWOzs7QUFGNkI7O0FBRG5DLGFBQUEsR0FBQTtBQUtJLGNBQUEsQ0FBTyxNQUFNLENBQU4sS0FBQSxDQUFQLEtBQU8sQ0FBUCxFQUFBO0FBQ0UsWUFBQSxHQUFHLENBQUgsSUFBQSxDQUFVLEVBQUcsQ0FBSCxJQUFHLENBQUgsQ0FBUztBQUFBLGVBQUEsSUFBQSxHQUFPO0FBQVAsYUFBVCxDQUFWOzs7QUFGQzs7QUFKUCxhQUFBLE1BQUE7QUFBQSxhQUFBLE1BQUE7QUFRSSxjQUFHLCtCQUFILEtBQUcsQ0FBSCxFQUFBO0FBQ0UsWUFBQSxHQUFHLENBQUgsSUFBQSxDQUFVLEVBQUcsQ0FBSCxJQUFHLENBQUgsQ0FBUztBQUFBLGVBQUEsSUFBQSxHQUFPO0FBQVAsYUFBVCxDQUFWOzs7QUFGUzs7QUFQZixhQUFBLEdBQUE7QUFXSSxjQUFJLDhCQUFELEtBQUMsQ0FBRCxJQUFxQixDQUFDLDJCQUFNLDBCQUEvQixLQUErQixDQUFOLENBQXpCLEVBQUE7QUFDRSxZQUFBLEdBQUcsQ0FBSCxJQUFBLENBQVUsRUFBRyxDQUFILElBQUcsQ0FBSCxDQUFTO0FBQUEsZUFBQSxJQUFBLEdBQU87QUFBUCxhQUFULENBQVY7OztBQUZDOztBQVZQLGFBQUEsTUFBQTtBQWNJLGNBQUEsQ0FBTywyQkFBTSxJQUFJLENBQUosU0FBQSxDQUFiLEtBQWEsQ0FBTixDQUFQLEVBQUE7QUFDRSxZQUFBLEdBQUcsQ0FBSCxJQUFBLENBQVUsRUFBRyxDQUFILElBQUcsQ0FBSCxDQUFTO0FBQUEsZUFBQSxJQUFBLEdBQU87QUFBUCxhQUFULENBQVY7OztBQUZDOztBQWJQO0FBaUJJLGdCQUFNLElBQUEsS0FBQSxDQUFVLHlCQUFBLElBQUEsbUNBQUEsSUFBVixHQUFBLENBQU47QUFqQko7O0FBRko7O1NBb0JBLDJCQUFNLEdBQU4sR0FBQSxDO0FBM0dGLENBcUZPLENBQVAsQzs7QUF5QkEsaUJBQUEsTUFBQSxHQUFTLHdCQUFNLFVBQUEsVUFBQSxFQUFBLElBQUEsRUFBQTtBQUNiLE1BQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxTQUFBLEVBQUEsSUFBQTtBQUFBLEVBQUEsR0FBQSxHQUFNLEVBQU47QUFDQSxHQUFBLFNBQUEsRUFBQSxJQUFBLElBQW9CLFVBQVUsQ0FBQyxHQUEvQjs7QUFFQSxNQUFHLElBQUEsSUFBSCxJQUFBLEVBQUE7O0FBRUUsSUFBQSxDQUFBLEdBQUksRUFBRyxDQUFBLFVBQVUsQ0FBQyxLQUFYLENBQUEsU0FBQSxDQUFBLENBQVA7QUFDQSxpQ0FBQSxHQUFBLEVBQWEsQ0FBQSxDQUFFO0FBQUEsT0FBQSxTQUFBLEdBQWEsSUFBSyxDQUFBLFNBQUE7QUFBbEIsS0FBRixDQUFiO0FBQ0EsSUFBQSxDQUFBLEdBQUksRUFBRyxDQUFBLFVBQVUsQ0FBQyxLQUFYLENBQUEsSUFBQSxDQUFBLENBQVA7QUFDQSxpQ0FBQSxHQUFBLEVBQWEsQ0FBQSxDQUFFO0FBQUEsT0FBQSxJQUFBLEdBQVEsSUFBSyxDQUFBLElBQUE7QUFBYixLQUFGLENBQWI7QUFMRixHQUFBLE1BQUE7O0FBUUUsSUFBQSxDQUFBLEdBQUksRUFBRyxDQUFBLFVBQVUsQ0FBQyxLQUFYLENBQUEsU0FBQSxDQUFBLENBQVA7O0FBQ0EsUUFBRyw4QkFBSCxJQUFHLENBQUgsRUFBQTtBQUNFLG1DQUFBLEdBQUEsRUFBYSxDQUFBLENBQUU7QUFBQSxTQUFBLFNBQUEsR0FBYSxJQUFLLENBQUEsU0FBQTtBQUFsQixPQUFGLENBQWI7QUFERixLQUFBLE1BQUE7QUFHRSxtQ0FBQSxHQUFBLEVBQWEsQ0FBQSxDQUFFO0FBQUEsU0FBQSxTQUFBLEdBQWE7QUFBYixPQUFGLENBQWI7QUFaSjs7O1NBY0EsRztBQWxCTyxDQUFBLENBQVQ7ZUFxQmU7QUFBQSxFQUFBLEVBQUE7QUFBQSxFQUFBLEtBQUE7QUFBQSxFQUFBLElBQUE7QUFBQSxFQUFBO0FBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbIiM9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiMgVHlwZSBIZWxwZXJzXG4jPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4jIER5bmFtb0RCIGluY2x1ZGVzIHR5cGUgaW5mb3JtYXRpb24gbWFwcGVkIGludG8gaXRzIGRhdGEgc3RyY3R1cmVzLlxuIyBJdCBleHBlY3RzIGRhdGEgdG8gYmUgaW5wdXQgdGhhdCB3YXksIGFuZCBpbmNsdWRlcyBpdCB3aGVuIGZldGNoZWQuXG4jIFRoZXNlIGhlbHBlcnMgd3JpdGUgYW5kIHBhcnNlIHRoYXQgdHlwZSBzeXN0ZW0uXG5pbXBvcnQge2N1cnJ5fSBmcm9tIFwicGFuZGEtZ2FyZGVuXCJcbmltcG9ydCB7ZW1wdHksIGtleXMsIHZhbHVlcywgZmlyc3QsXG4gIG1lcmdlLCBpbmNsdWRlLCBpc1R5cGUsIGlzQm9vbGVhbiwgaXNPYmplY3QsIGlzQXJyYXl9IGZyb20gXCJwYW5kYS1wYXJjaG1lbnRcIlxuXG5pc1NldCA9IGlzVHlwZSBTZXRcblxuX3RyYW5zZm9ybSA9IChmKSAtPlxuICAoeCkgLT5cbiAgICBpZiBpc09iamVjdCB4XG4gICAgICBvdXQgPSB7fVxuICAgICAgb3V0W2tdID0gX21hcmsoXCJhbm9ueW1vdXNEeW5hbW9kYlZhbHVlXCIsIGYgdikgZm9yIGssIHYgb2YgeFxuICAgICAgX21hcmsgXCJuYW1lZER5bmFtb2RiVmFsdWVcIiwgb3V0XG4gICAgZWxzZSBpZiAheD9cbiAgICAgIHRocm93IG5ldyBFcnJvciBcInN1bmRvZzo6ZHluYW1vZGI6OnRvIENhbm5vdCB0eXBlIGNhc3QgdmFsdWUgdGhhdCBpcyB1bmRlZmluZWQuXCJcbiAgICBlbHNlXG4gICAgICBfbWFyayBcImFub255bW91c0R5bmFtb2RiVmFsdWVcIiwgZiB4XG5cbl9tYXJrID0gKG5hbWUsIG9iamVjdCkgLT4gT2JqZWN0LmRlZmluZVByb3BlcnR5IG9iamVjdCwgXCJuYW1lXCIsIHZhbHVlOiBuYW1lXG5cbnRvID1cbiAgUzogX3RyYW5zZm9ybSAocykgLT4gUzogcy50b1N0cmluZygpXG4gIE46IF90cmFuc2Zvcm0gKG4pIC0+IE46IG4udG9TdHJpbmcoKVxuICBCOiBfdHJhbnNmb3JtIChiKSAtPiBCOiBiLnRvU3RyaW5nKFwiYmFzZTY0XCIpXG4gIFNTOiBfdHJhbnNmb3JtIChhKSAtPlxuICAgIGlmIGlzU2V0IGEgdGhlbiBhID0gQXJyYXkuZnJvbSBhXG4gICAgU1M6IChpLnRvU3RyaW5nKCkgZm9yIGkgaW4gYSlcbiAgTlM6IF90cmFuc2Zvcm0gKGEpIC0+XG4gICAgaWYgaXNTZXQgYSB0aGVuIGEgPSBBcnJheS5mcm9tIGFcbiAgICBOUzogKGkudG9TdHJpbmcoKSBmb3IgaSBpbiBhKVxuICBCUzogX3RyYW5zZm9ybSAoYSkgLT5cbiAgICBpZiBpc1NldCBhIHRoZW4gYSA9IEFycmF5LmZyb20gYVxuICAgIEJTOiAoaS50b1N0cmluZyhcImJhc2U2NFwiKSBmb3IgaSBpbiBhKVxuICBNOiBfdHJhbnNmb3JtIChtKSAtPiBNOiBtXG4gIEw6IF90cmFuc2Zvcm0gKGwpIC0+IEw6IGxcbiAgTlVMTDogX3RyYW5zZm9ybSAobikgLT4gTlVMTDogblxuICBCT09MOiBfdHJhbnNmb3JtIChiKSAtPiBCT09MOiBiXG4gICMgRXh0ZW5zaW9uIG9mIER5bmFtb0RCIHR5cGVzIHRvIHN0cmluZ2lmeSBvYmplY3RzLiAqTXVzdCBhbHdheXMgYmUgbmFtZWQuKlxuICBKU09OOiBfdHJhbnNmb3JtIChvKSAtPiBTOiBKU09OLnN0cmluZ2lmeSBvXG5cbiMgVGhpcyBoYW5kbGVzIHBhcnNpbmcgb24gdGhlIGRhdGEgdHlwZXMgbmF0aXZlIHRvIER5bmFtb0RCLCBpbmNsdWRpbmcgcmVjdXJzaXZlIHBhcnNpbmcgb24gTWFwcy5cbl9wYXJzZSA9IChhdHRyaWJ1dGVzKSAtPlxuICByZXN1bHQgPSB7fVxuICBmb3IgbmFtZSwgdHlwZU9iaiBvZiBhdHRyaWJ1dGVzXG4gICAgZGF0YVR5cGUgPSBmaXJzdCBrZXlzIHR5cGVPYmpcbiAgICB2ID0gZmlyc3QgdmFsdWVzIHR5cGVPYmpcbiAgICByZXN1bHRbbmFtZV0gPSBzd2l0Y2ggZGF0YVR5cGVcbiAgICAgIHdoZW4gXCJTXCIsIFwiQk9PTFwiIHRoZW4gdlxuICAgICAgd2hlbiBcIk5cIiB0aGVuIE51bWJlciB2XG4gICAgICB3aGVuIFwiQlwiIHRoZW4gQnVmZmVyLmZyb20gdiwgXCJiYXNlNjRcIlxuICAgICAgd2hlbiBcIlNTXCIgdGhlbiBuZXcgU2V0IHZcbiAgICAgIHdoZW4gXCJOU1wiIHRoZW4gbmV3IFNldCAoTnVtYmVyIGkgZm9yIGkgaW4gdilcbiAgICAgIHdoZW4gXCJCU1wiIHRoZW4gbmV3IFNldCAoQnVmZmVyLmZyb20gaSwgXCJiYXNlNjRcIiBmb3IgaSBpbiB2KVxuICAgICAgd2hlbiBcIk5VTExcIlxuICAgICAgICBpZiB2IHRoZW4gbnVsbCBlbHNlIHVuZGVmaW5lZFxuICAgICAgd2hlbiBcIkxcIiB0aGVuIChwYXJzZSBpIGZvciBpIGluIHYpXG4gICAgICB3aGVuIFwiTVwiIHRoZW4gcGFyc2UgdlxuICAgICAgZWxzZVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJVbmFibGUgdG8gcGFyc2Ugb2JqZWN0IGZvciBEeW5hbW9EQiBhdHRyaWJ1dGUgdHlwZS4gI3tkYXRhVHlwZX1cIlxuICByZXN1bHRcblxuIyBUaGlzIHdyYXBzIF9wYXJzZSB0byBleHRlbmQgcGFyc2luZyB0byBkYXRhIHR5cGVzIHdlIGRlZmluZS5cbnBhcnNlID0gY3VycnkgKHR5cGVzLCBkYXRhKSAtPlxuICByZXN1bHQgPSBfcGFyc2UgZGF0YVxuICBmb3IgbmFtZSwgdmFsdWUgb2YgcmVzdWx0XG4gICAgdHlwZSA9IHR5cGVzW25hbWVdXG4gICAgcmVzdWx0W25hbWVdID0gc3dpdGNoIHR5cGVcbiAgICAgICMgTm9PcHMgb24gdGhlIGJhc2UgdHlwZXNcbiAgICAgIHdoZW4gXCJTXCIsIFwiTlwiLCBcIkJPT0xcIiwgXCJTU1wiLCBcIkxcIiwgXCJCXCIsIFwiTlNcIiwgXCJCU1wiLCBcIk5VTExcIiwgXCJNXCJcbiAgICAgICAgdmFsdWVcbiAgICAgICMgRXh0ZW5zaW9uc1xuICAgICAgd2hlbiBcIkpTT05cIlxuICAgICAgICBKU09OLnBhcnNlIHZhbHVlXG4gICAgICBlbHNlXG4gICAgICAgIHRocm93IG5ldyBFcnJvciBcIkZvciAje25hbWV9LCAje3R5cGV9IGlzIG5vdCBhIGtub3duIER5bmFtb0RCIHR5cGUgb3Igc3VuZG9nIGV4dGVuc2lvbi5cIlxuICByZXN1bHRcblxuIyBBY2NlcHQgYW4gaW5jb21pbmcgb2JqZWN0IHRvIHN0b3JlIGluIER5bmFtb0RCLCByZWplY3RpbmcgZmllbGRzIHRoYXQgZG8gbm90IGhhdmUgYSBkZWZpbmVkIHR5cGUgb3IgYXJlIG5vdCBzdWl0YWJsZSBmb3IgRHluYW1vREIuXG4jIEZyb20gdGhlaXIgZG9jczpcbiMgPiBBdHRyaWJ1dGUgdmFsdWVzIGNhbm5vdCBiZSBudWxsLiBTdHJpbmcgYW5kIEJpbmFyeSB0eXBlIGF0dHJpYnV0ZXMgbXVzdCBoYXZlIGxlbmd0aHMgZ3JlYXRlciB0aGFuIHplcm8uIFNldCB0eXBlIGF0dHJpYnV0ZXMgY2Fubm90IGJlIGVtcHR5Llxud3JhcCA9IGN1cnJ5ICh0eXBlcywgZGF0YSkgLT5cbiAgb3V0ID0gW11cbiAgZm9yIG5hbWUsIHZhbHVlIG9mIGRhdGFcbiAgICBpZiAodHlwZSA9IHR5cGVzW25hbWVdKT8gJiYgdmFsdWU/XG4gICAgICBzd2l0Y2ggdHlwZVxuICAgICAgICB3aGVuIFwiU1wiLCBcIlNTXCIsIFwiTlNcIiwgXCJCU1wiLCBcIkxcIiwgXCJCXCJcbiAgICAgICAgICB1bmxlc3MgZW1wdHkgdmFsdWVcbiAgICAgICAgICAgIG91dC5wdXNoICh0b1t0eXBlXSBbbmFtZV06dmFsdWUpXG4gICAgICAgIHdoZW4gXCJOXCJcbiAgICAgICAgICB1bmxlc3MgTnVtYmVyLmlzTmFOIHZhbHVlXG4gICAgICAgICAgICBvdXQucHVzaCAodG9bdHlwZV0gW25hbWVdOnZhbHVlKVxuICAgICAgICB3aGVuIFwiQk9PTFwiLCBcIk5VTExcIlxuICAgICAgICAgIGlmIGlzQm9vbGVhbiB2YWx1ZVxuICAgICAgICAgICAgb3V0LnB1c2ggKHRvW3R5cGVdIFtuYW1lXTp2YWx1ZSlcbiAgICAgICAgd2hlbiBcIk1cIlxuICAgICAgICAgIGlmIChpc09iamVjdCB2YWx1ZSkgJiYgKCFlbXB0eSBrZXlzIHZhbHVlKVxuICAgICAgICAgICAgb3V0LnB1c2ggKHRvW3R5cGVdIFtuYW1lXTp2YWx1ZSlcbiAgICAgICAgd2hlbiBcIkpTT05cIlxuICAgICAgICAgIHVubGVzcyBlbXB0eSBKU09OLnN0cmluZ2lmeSB2YWx1ZVxuICAgICAgICAgICAgb3V0LnB1c2ggKHRvW3R5cGVdIFtuYW1lXTp2YWx1ZSlcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvciBcIlVuYWJsZSB0byB3cmFwIGZpZWxkICcje25hbWV9Jy4gVW5rbm93biBEeWFubW9EQiBkYXRhIHR5cGUsICcje3R5cGV9J1wiXG4gIG1lcmdlIG91dC4uLlxuXG4jIEdpdmVuIGRhdGEgYW5kIGEgbW9kZWwgZGVmaW5pdGlvbiwgcmV0dXJuIHRoZSBrZXkgZm9yIHRoaXMgb2JqZWN0LlxuZ2V0S2V5ID0gY3VycnkgKGRlZmluaXRpb24sIGRhdGEpIC0+XG4gIGtleSA9IHt9XG4gIFtwYXJ0aXRpb24sIHNvcnRdID0gZGVmaW5pdGlvbi5rZXlcblxuICBpZiBzb3J0P1xuICAgICMgSWYgdGhlcmUgaXMgYSBzb3J0IGtleSwgZGF0YSBtdXN0IGJlIGFuIG9iamVjdCBhbmQgd3JhcCBib3RoLlxuICAgIGYgPSB0b1tkZWZpbml0aW9uLnR5cGVzW3BhcnRpdGlvbl1dXG4gICAgaW5jbHVkZSBrZXksIGYgW3BhcnRpdGlvbl06IGRhdGFbcGFydGl0aW9uXVxuICAgIGYgPSB0b1tkZWZpbml0aW9uLnR5cGVzW3NvcnRdXVxuICAgIGluY2x1ZGUga2V5LCBmIFtzb3J0XTogZGF0YVtzb3J0XVxuICBlbHNlXG4gICAgIyBXaXRoIG5vIHNvcnQga2V5LCBpdCdzIHBvc3NpYmxlIHdlJ3ZlIGJlZW4gZ2l2ZW4ganVzdCBhIHZhbHVlIHRvIGJlIHdyYXBwZWQgYXMgdGhlIHBhcnRpdGlvbiBrZXkuXG4gICAgZiA9IHRvW2RlZmluaXRpb24udHlwZXNbcGFydGl0aW9uXV1cbiAgICBpZiBpc09iamVjdCBkYXRhXG4gICAgICBpbmNsdWRlIGtleSwgZiBbcGFydGl0aW9uXTogZGF0YVtwYXJ0aXRpb25dXG4gICAgZWxzZVxuICAgICAgaW5jbHVkZSBrZXksIGYgW3BhcnRpdGlvbl06IGRhdGFcblxuICBrZXlcblxuXG5leHBvcnQgZGVmYXVsdCB7dG8sIHBhcnNlLCB3cmFwLCBnZXRLZXl9XG5leHBvcnQge3RvLCBwYXJzZSwgd3JhcCwgZ2V0S2V5fVxuIl0sInNvdXJjZVJvb3QiOiIifQ==
//# sourceURL=/Users/david/repos/sundog/src/primitives/dynamodb/helpers/types.coffee